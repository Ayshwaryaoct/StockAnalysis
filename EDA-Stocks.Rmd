---
title: "Visualization-Stock Analysis"
author: "Tina"
date: "4/24/2018"
output: html_document
---
PLOT CLOSE PRICES OF COMPANIES TO OBSERVE THE TREND
```{r}

library(quantmod)
library(PerformanceAnalytics)
library(ggplot2)
library(reshape2)
library(iClick)
library(plyr)
library(scales)
# FINANCE
start <- as.Date("1998-02-01")
end <- as.Date("2018-02-01")
getSymbols(c("JPM", "WFC" , "C"), src = "yahoo", from = start, to = end)
stocks <- as.xts(data.frame(JPM = JPM[, "JPM.Close"], WFC = WFC[, "WFC.Close"], 
    C = C[, "C.Close"]))
head(stocks)

plot(as.zoo(stocks[, c("JPM.Close", "WFC.Close")]), screens = 1, lty = 1:2, 
    xlab = "Date", ylab = "Price", col= c("blue", "red"))
par(new = TRUE)
plot(as.zoo(stocks[, "C.Close"]), screens = 1, lty = 3, xaxt = "n", yaxt = "n", 
    xlab = "", ylab = "", col = "green")
axis(4)
mtext("Price", side = 4, line = 3)
legend("topleft", c("JPM", "WFC", "C"), lty = 1:3, cex = 0.5)

 # IT

getSymbols(c("AAPL", "HP" , "INTC"), src = "yahoo", from = start, to = end)
stocks_IT <- as.xts(data.frame(AAPL = AAPL[, "AAPL.Close"], HP = HP[, "HP.Close"], INTC = INTC[, "INTC.Close"]))
#head(stocks)

plot(as.zoo(stocks_IT[, c("AAPL.Close", "HP.Close")]), screens = 1, lty = 1:2, 
    xlab = "Date", ylab = "Price", col= c("blue", "red"))
par(new = TRUE)
plot(as.zoo(stocks_IT[, "INTC.Close"]), screens = 1, lty = 3, xaxt = "n", yaxt = "n", 
    xlab = "", ylab = "", col = "green")
axis(4)
mtext("Price", side = 4, line = 3)
legend("topleft", c("AAPL (left)", "HP (left)", "INTC"), lty = 1:3, cex = 0.5)

# ENERGY
getSymbols(c("COP","MRO", "OXY"), src = "yahoo", from = start, to = end)
stocks_ENERGY <- as.xts(data.frame(COP = COP[, "COP.Close"], MRO = MRO[, "MRO.Close"], OXY = OXY[, "OXY.Close"]))
#head(stocks)

plot(as.zoo(stocks_ENERGY[, c("COP.Close", "MRO.Close")]), screens = 1, lty = 1:2, 
    xlab = "Date", ylab = "Price", col= c("blue", "red"))
par(new = TRUE)
plot(as.zoo(stocks_ENERGY[, "OXY.Close"]), screens = 1, lty = 3, xaxt = "n", yaxt = "n", 
    xlab = "", ylab = "", col = "green")
axis(4)
mtext("Price", side = 4, line = 3)
legend("topleft", c("COP","MRO", "OXY"), lty = 1:3, cex = 0.5)

# PHARMA

#getSymbols(c("ABBV","BMY","PFE"), src = "yahoo", from = start, to = end)
#stocks_PHARMA <- as.xts(data.frame(ABBV = ABBV[, "ABBV.Close"], BMY = BMY[, "BMY.Close"], PFE = PFE[, "PFE.Close"]))
#head(stocks)

#plot(as.zoo(stocks_PHARMA[, c("ABBV.Close", "BMY.Close")]), screens = 1, lty = 1:2, 
#    xlab = "Date", ylab = "Price", col= c("blue", "red"))
#par(new = TRUE)
#plot(as.zoo(stocks_PHARMA[, "PFE.Close"]), screens = 1, lty = 3, xaxt = "n", yaxt = "n", 
 #   xlab = "", ylab = "", col = "green")
#axis(4)
#mtext("Price", side = 4, line = 3)
#legend("topleft", c("ABBV","BMY","PFE"), lty = 1:3, cex = 0.5)

```
This could be misleading and a better plot would be stock's returns.

PLOT STOCK'S RETURN
```{r}
library(magrittr)
# FINANCE
stock_return = apply(stocks, 1, function(x) {x / stocks[1,]}) %>% 
                                    t %>% as.xts
plot(as.zoo(stock_return), screens = 1, lty = 1:3, xlab = "Date", ylab = "Return",col =c("blue" , "red","green"))
legend("topleft", c("JPM", "WFC", "C"), lty = 1:3, cex = 0.5)

#head(stock_return)

#IT

stock_return_IT = apply(stocks_IT, 1, function(x) {x / stocks_IT[1,]}) %>% 
                                    t %>% as.xts
plot(as.zoo(stock_return_IT), screens = 1, lty = 1:3, xlab = "Date", ylab = "Return",col =c("blue" , "red","green"))
legend("topleft", c("AAPL", "HP" , "INTC"), lty = 1:3, cex = 0.5)


#ENERGY

stock_return_ENERGY = apply(stocks_ENERGY, 1, function(x) {x / stocks_ENERGY[1,]}) %>% 
                                    t %>% as.xts

plot(as.zoo(stock_return_ENERGY), screens = 1, lty = 1:3, xlab = "Date", ylab = "Return",col =c("blue" , "red","green"))
legend("topleft", c("COP","MRO", "OXY"), lty = 1:3, cex = 0.5)

```
CORRELOGRAM
```{r}
library(ggcorrplot)
#Create Vector of Tickers
tickers <- c("ABBV","BMY","PFE","COP","MRO", "OXY" ,"AAPL","HP", "INTC",  "JPM", "WFC", "C")

#Calculate Returns: Daily
portfolioPrices <- NULL
for (Ticker in tickers)
  portfolioPrices <- cbind(portfolioPrices,
                           getSymbols.yahoo(Ticker, from="2016-01-01", auto.assign=FALSE)[,4]) 

#Delete all dates with no prices
portfolioPrices <- portfolioPrices[apply(portfolioPrices,1,function(x) all(!is.na(x))),]
#Rename Columns
colnames(portfolioPrices) <- tickers

#create cor matrix
corr <- cor(portfolioPrices)

#------------------------Correlogram---------------------------#
ggcorrplot(corr, hc.order = TRUE, 
           type = "lower", 
           lab = TRUE, 
           lab_size = 3, 
           method="circle", 
           colors = c("springgreen3", "white", "tomato2"), 
           title="Correlogram of Assets",
           legend.title = 'Pearson Correlation',
           ggtheme=theme_gray) +
           theme(plot.title = element_text(hjust = 0.5))



```


